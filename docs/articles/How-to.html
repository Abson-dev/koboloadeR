<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>7 Steps to build fully reproducible analysis • koboloadeR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="7 Steps to build fully reproducible analysis">
<meta property="og:description" content="koboloadeR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-142392388-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-142392388-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">koboloadeR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Crunching.html">Data Crunching</a>
    </li>
    <li>
      <a href="../articles/Getting_data.html">Getting data from server</a>
    </li>
    <li>
      <a href="../articles/xlsform.html">Data Analysis Plan within your `xlsfrom`</a>
    </li>
    <li>
      <a href="../articles/Console.html">Using console script</a>
    </li>
    <li>
      <a href="../articles/Sampling.html">Sampling</a>
    </li>
    <li>
      <a href="../articles/Anonymisation.html">Data Anonymisation and disclosure risk measurement</a>
    </li>
    <li>
      <a href="../articles/Cleaning.html">Data Cleaning</a>
    </li>
    <li>
      <a href="../articles/Predicting_Scoring.html">Predicting and scoring</a>
    </li>
    <li>
      <a href="../articles/Troubleshooting.html">Common Troubleshooting</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/unhcr/koboloadeR/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="How-to_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="How-to_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="How-to_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>7 Steps to build fully reproducible analysis</h1>
            
            <h4 class="date">2020-11-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/unhcr/koboloadeR/blob/master/vignettes/How-to.Rmd"><code>vignettes/How-to.Rmd</code></a></small>
      <div class="hidden name"><code>How-to.Rmd</code></div>

    </div>

    
    
<p>Below is a step by step guidance on how to generate quickly a fully reproducible analysis</p>
<div id="presentation-of-features" class="section level4">
<h4 class="hasAnchor">
<a href="#presentation-of-features" class="anchor"></a>Presentation of features</h4>
<ul>
<li><p><a href="articles/Getting_data.html">Getting data from server</a> - How to retrieve data from the server within R?</p></li>
<li><p><a href="articles/xlsform.html">Data Analysis Plan within your <code>xlsfrom</code></a> - How to extend the xlsform to include your analysis plan?</p></li>
<li><p><a href="articles/Console.html">Using console script</a> - How to use the package without using the GUI in Shiny?</p></li>
<li><p><a href="articles/Sampling.html">Sampling</a>: how to generate a sample from a registry or to post-stratify data when having a low response rate?</p></li>
<li><p><a href="articles/Anonymisation.html">Data Anonymisation and disclosure risk measurement</a>: how to create anonymised data?</p></li>
<li><p><a href="articles/Cleaning.html">Data Cleaning</a>: how to use the package for reproducible and documented data cleaning?</p></li>
<li><p><a href="articles/Predicting_Scoring.html">Predicting and scoring</a>: how to use survey in conjunction wiht registration data to build risk prediction and vulnerability scoring?</p></li>
<li><p><a href="articles/Dissiminating.html">Dissiminating</a>: how to dissiminate both survey microdata using DDI and variable crosstabulation on CKAN?</p></li>
</ul>
</div>
<div id="step-1-set-up-your-rstudio-project" class="section level2">
<h2 class="hasAnchor">
<a href="#step-1-set-up-your-rstudio-project" class="anchor"></a>Step 1: Set up your Rstudio project</h2>
<p>From Rstudio, create a new project - then make sure to install the necessary packages:</p>
<p><a href="https://unhcr-web.github.io/hcrdata/docs/">hcrdata</a> to connect to both Kobo &amp; RIDL API</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co">## API to connect to internal data sources</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>remotes<span class="op">::</span><span class="kw">install_github</span>(<span class="st">'unhcr-web/hcrdata’)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Use UNHCR graphical template- https://unhcr-web.github.io/unhcRstyle/docs/</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">'unhcr-web/unhcRstyle'</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">## Perform High Frequency Check https://unhcr.github.io/HighFrequencyChecks/docs/</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>remotes<span class="op">::</span><span class="kw">install_github</span>(<span class="st">'unhcr/HighFrequencyChecks’)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co">## Process data crunching for survey dataset - https://unhcr.github.io/koboloadeR/docs/</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>remotes<span class="op">::</span><span class="kw">install_github</span>(<span class="st">'unhcr/koboloadeR’)</span></span></code></pre></div>
<p>You can now prepare your project</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span> <span class="op">(</span><span class="va"><a href="https://unhcr.github.io/koboloadeR/docs/">koboloadeR</a></span><span class="op">)</span> <span class="co"># This loads koboloadeR package</span>

<span class="fu"><a href="../reference/kobo_projectinit.html">kobo_projectinit</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Creates folders necessary and transfer files needed</span></code></pre></div>
<p>This last function creates a structure of folders that is consistent with R regular package structure</p>
<ul>
<li>
<code>R</code> where processing scripts are stored</li>
<li>
<code>data-raw</code> where raw data are stored</li>
<li>
<code>data</code> where processed data are kept</li>
<li>
<code>vignettes</code> where generated Rmarkdown</li>
<li>
<code>out</code> where generated report (knitted markdown) in word/powerpoint or html are pushed</li>
</ul>
</div>
<div id="step-2-get-data-and-form-from-your-kobo-project" class="section level2">
<h2 class="hasAnchor">
<a href="#step-2-get-data-and-form-from-your-kobo-project" class="anchor"></a>Step 2: get data and form from your Kobo Project</h2>
<p>In order to complete this step, you can either:</p>
<ul>
<li><p>Use the web interface and put the files into the <code>data-raw</code> folder</p></li>
<li><p>pull from API with HCRdata</p></li>
</ul>
<p>Open a new R script within a new RStudio project.</p>
<p>You should then be able to launch the “data browser” within <a href="https://rstudio.github.io/rstudio-extensions/rstudio_addins.html">Rstudio addins</a> menu or with the following command in your console:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">hcrdata</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/pkg/hcrdata/man/hcrbrowse.html">hcrbrowse</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>From there you will need to: 1. select the source 2. go to the dataset tab and select the project you want to pull data from 3. go to the files tab and select the specific file you want to retrieve from the project. 4. press the load data button and the R statement to pull this file from your project will be automatically inserted in your blank R script tab</p>
<div class="figure">
<img src="https://i.imgur.com/1hEUFkd.png" alt=""><p class="caption">preview</p>
</div>
<p>alternatively, if you have the uniqueID of your koboproject</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co">## pulling data from RIDL</span>
<span class="va">dataset</span> <span class="op">&lt;-</span>  <span class="st">"dataset-title-in-kobo"</span>

<span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu">dir_exists</span><span class="op">(</span><span class="st">"data-raw"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">dir_create</span><span class="op">(</span><span class="fu">path</span><span class="op">(</span><span class="st">"data-raw"</span><span class="op">)</span><span class="op">)</span>
  
  
  <span class="fu">hcrdata</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/hcrdata/man/hcrfetch.html">hcrfetch</a></span><span class="op">(</span>src <span class="op">=</span> <span class="st">"kobo"</span>, 
                    dataset <span class="op">=</span> <span class="va">dataset</span>, 
                    file <span class="op">=</span> <span class="st">"form.xls"</span><span class="op">)</span>
                    
<span class="fu">hcrdata</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/hcrdata/man/hcrfetch.html">hcrfetch</a></span><span class="op">(</span>src <span class="op">=</span> <span class="st">"kobo"</span>, 
                  dataset <span class="op">=</span> <span class="va">dataset</span>, 
                  file <span class="op">=</span> <span class="st">"data.json"</span><span class="op">)</span>

<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.copy</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"data-raw/"</span>,<span class="va">dataset</span>,<span class="st">"/form.xls"</span><span class="op">)</span>,
          to   <span class="op">=</span> <span class="st">"data-raw/form.xls"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.copy</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"data-raw/"</span>,<span class="va">dataset</span>,<span class="st">"/maindataframe.csv"</span><span class="op">)</span>,
          to   <span class="op">=</span> <span class="st">"data-raw/MainDataFrame.csv"</span><span class="op">)</span></code></pre></div>
</div>
<div id="step-3-prepare-your-report-configuration-in-xlsform" class="section level2">
<h2 class="hasAnchor">
<a href="#step-3-prepare-your-report-configuration-in-xlsform" class="anchor"></a>Step 3: Prepare your report configuration in xlsform</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Change here the precise name of the form if required</span>
<span class="va">form</span> <span class="op">&lt;-</span> <span class="st">"form.xls"</span> 

<span class="co">## Extend xlsform with required column if necessary - done only once!</span>
<span class="co">#kobo_prepare_form(form)</span></code></pre></div>
</div>
<div id="step-4-add-calculated-indicators-clean-and-anonymise-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#step-4-add-calculated-indicators-clean-and-anonymise-the-data" class="anchor"></a>Step 4: Add calculated indicators, clean and anonymise the data</h2>
</div>
<div id="step-6-prepare-your-analysis-post" class="section level2">
<h2 class="hasAnchor">
<a href="#step-6-prepare-your-analysis-post" class="anchor"></a>Step 6: Prepare your analysis post</h2>
</div>
<div id="step-5-document-the-data-and-push-it-from-kobo-to-ridl" class="section level2">
<h2 class="hasAnchor">
<a href="#step-5-document-the-data-and-push-it-from-kobo-to-ridl" class="anchor"></a>Step 5: Document the data and push it from kobo to RIDL</h2>
</div>
<div id="step-7-submit-your-analysis-post-to-the-internal-analysis-repository" class="section level2">
<h2 class="hasAnchor">
<a href="#step-7-submit-your-analysis-post-to-the-internal-analysis-repository" class="anchor"></a>Step 7: Submit your analysis post to the Internal Analysis Repository</h2>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co">## pulling data from RIDL</span>
<span class="va">dataset</span> <span class="op">&lt;-</span>  <span class="st">"dataset-title-in-rild"</span>

<span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu">dir_exists</span><span class="op">(</span><span class="st">"data-raw"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">dir_create</span><span class="op">(</span><span class="fu">path</span><span class="op">(</span><span class="st">"data-raw"</span><span class="op">)</span><span class="op">)</span>
  
  
  <span class="fu">hcrdata</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/hcrdata/man/hcrfetch.html">hcrfetch</a></span><span class="op">(</span>src <span class="op">=</span> <span class="st">"ridl"</span>, 
                    dataset <span class="op">=</span> <span class="va">dataset</span>, 
                    file <span class="op">=</span> <span class="st">"form.xls"</span>,
                    <span class="co">#path= here::here("data-raw",  file),</span>
                    cache <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu">hcrdata</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/hcrdata/man/hcrfetch.html">hcrfetch</a></span><span class="op">(</span>src <span class="op">=</span> <span class="st">"ridl"</span>, 
                  dataset <span class="op">=</span> <span class="va">dataset</span>, 
                  file <span class="op">=</span> <span class="st">"maindataframe.csv"</span>,
                    <span class="co">#path= here::here("data-raw",  file),</span>
                    cache <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.copy</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"data-raw/"</span>,<span class="va">dataset</span>,<span class="st">"/form.xls"</span><span class="op">)</span>,
          to   <span class="op">=</span> <span class="st">"data-raw/form.xls"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.copy</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"data-raw/"</span>,<span class="va">dataset</span>,<span class="st">"/maindataframe.csv"</span><span class="op">)</span>,
          to   <span class="op">=</span> <span class="st">"data-raw/MainDataFrame.csv"</span><span class="op">)</span>


<span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu">dir_exists</span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">dir_create</span><span class="op">(</span><span class="fu">path</span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span><span class="op">)</span>
  
    <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu">dir_exists</span><span class="op">(</span><span class="st">"R"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
      <span class="fu">dir_create</span><span class="op">(</span><span class="fu">path</span><span class="op">(</span><span class="st">"R"</span><span class="op">)</span><span class="op">)</span>
      
      <span class="va">form</span> <span class="op">&lt;-</span> <span class="st">"form.xls"</span>
      <span class="fu">koboloadeR</span><span class="fu">::</span><span class="fu"><a href="../reference/kobo_load_data.html">kobo_load_data</a></span><span class="op">(</span><span class="op">)</span>
    
    <span class="op">}</span>
<span class="op">}</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Edouard Legoupil, Maher Daoud, Hisham Galal.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
